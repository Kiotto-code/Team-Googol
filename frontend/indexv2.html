<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lost & Found</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

	<!-- Header -->
	<header class="bg-gray-800 shadow-lg sticky top-0 z-10">
		<div class="max-w-7xl mx-auto flex items-center justify-between p-5">
			<h1 class="text-3xl font-bold">Lost & Found</h1>
			<button onclick="showHomePage()"
				class="px-5 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-xl text-base font-medium shadow-lg">
				Home
			</button>
		</div>
	</header>

	<!-- Main content -->
	<main id="mainContent" class="flex-grow flex items-center justify-center p-8">

		<!-- Home Page -->
		<div id="homePage" class="grid grid-cols-1 sm:grid-cols-2 gap-8 w-full max-w-5xl">
			<button onclick="showUploadPage()"
				class="bg-indigo-600 hover:bg-indigo-500 rounded-2xl p-20 flex flex-col items-center justify-center text-2xl font-bold shadow-xl transition transform hover:scale-105">
				üì∏ Found an Item?
			</button>
			<button onclick="showSearchPage()"
				class="bg-teal-600 hover:bg-teal-500 rounded-2xl p-20 flex flex-col items-center justify-center text-2xl font-bold shadow-xl transition transform hover:scale-105">
				üîç Lost an Item?
			</button>
		</div>

		<!-- Upload Page -->
		<div id="uploadPage" class="hidden w-full max-w-3xl space-y-8">
			<h2 class="text-2xl font-bold">Upload an Item</h2>
			<p class="text-base text-gray-400">Please ensure the photo is in <span
					class="font-semibold text-gray-200">good lighting</span> and <span
					class="font-semibold text-gray-200">proper framing</span>.</p>

			<form id="uploadForm" class="space-y-6">
				<!-- Image input -->
				<div class="space-y-4">
					<input type="file" id="imageInput" name="image" accept="image/*"
						class="block w-full border border-gray-700 rounded-xl p-4 bg-gray-800 text-lg cursor-pointer">
					<!-- Preview -->
					<div id="imagePreview" class="hidden">
						<p class="text-gray-300 mb-2">Preview:</p>
						<img id="previewImg"
							class="w-full max-h-80 object-contain rounded-lg border border-gray-700 shadow-md" />
					</div>
				</div>

				<!-- Description -->
				<textarea name="description" rows="4" placeholder="Optional description..."
					class="w-full border border-gray-700 rounded-xl p-4 bg-gray-800 text-lg"></textarea>

				<!-- Upload button -->
				<button type="submit"
					class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 
             rounded-2xl font-bold text-lg shadow-xl flex items-center justify-center gap-2 transition transform hover:scale-105">
					‚¨ÜÔ∏è Upload Item
				</button>
			</form>

			<div id="uploadResult" class="text-lg mt-4"></div>
		</div>

		<!-- Search Page -->
		<div id="searchPage" class="hidden w-full max-w-3xl space-y-8">
			<h2 class="text-2xl font-bold">Search for Your Lost Item</h2>
			<p class="text-base text-gray-400">
				Be as descriptive as possible.<br>
				Example: <span class="italic">"Color: Navy blue; Type: Water bottle; Material: Stainless steel;
					Features: Loop handle, logo"</span>
			</p>
			<form id="searchForm" class="space-y-6">
				<input type="text" name="query" placeholder="Describe your item..."
					class="w-full border border-gray-700 rounded-xl p-4 bg-gray-800 text-lg">
				<button type="submit"
					class="w-full py-4 bg-teal-600 hover:bg-teal-500 rounded-xl font-bold text-lg shadow-lg">
					Search
				</button>
			</form>
			<div id="searchResults" class="space-y-6"></div>
		</div>

	</main>

	<script>
		function showHomePage() {
			document.getElementById('homePage').classList.remove('hidden');
			document.getElementById('uploadPage').classList.add('hidden');
			document.getElementById('searchPage').classList.add('hidden');
		}

		function showUploadPage() {
			document.getElementById('homePage').classList.add('hidden');
			document.getElementById('uploadPage').classList.remove('hidden');
			document.getElementById('searchPage').classList.add('hidden');
		}

		function showSearchPage() {
			document.getElementById('homePage').classList.add('hidden');
			document.getElementById('uploadPage').classList.add('hidden');
			document.getElementById('searchPage').classList.remove('hidden');
		}

		// Upload form
		document.getElementById('uploadForm')?.addEventListener('submit', async (e) => {
			e.preventDefault();
			const formData = new FormData(e.target);
			const res = await fetch("http://127.0.0.1:5000/upload", { method: "POST", body: formData });
			const result = await res.json();
			document.getElementById('uploadResult').textContent = res.ok ? "‚úÖ " + result.message : "‚ùå " + result.error;
		});

		// Search form
		document.getElementById('searchForm')?.addEventListener('submit', async (e) => {
			e.preventDefault();
			const query = e.target.query.value;
			const res = await fetch("http://127.0.0.1:5000/search", {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ query })
			});
			const resultDiv = document.getElementById('searchResults');
			resultDiv.innerHTML = "";
			const data = await res.json();
			if (res.ok) {
				data.results.forEach(r => {
					const item = document.createElement("div");
					item.className = "p-6 bg-gray-800 rounded-xl shadow-lg";
					item.innerHTML = `
            <p class="font-bold text-lg">${r.description || "No description"}</p>
            <p class="text-gray-400 text-sm">Score: ${r.score.toFixed(2)}</p>
            <img src="${r.url}" alt="Result" class="mt-3 max-h-64 w-full object-contain rounded">
          `;
					resultDiv.appendChild(item);
				});
			} else {
				resultDiv.textContent = "‚ùå " + (data.error || data.message);
			}
		});

		// Show preview when image is selected
		document.getElementById("imageInput")?.addEventListener("change", (e) => {
			const file = e.target.files[0];
			const preview = document.getElementById("imagePreview");
			const previewImg = document.getElementById("previewImg");

			if (file) {
				const reader = new FileReader();
				reader.onload = (event) => {
					previewImg.src = event.target.result;
					preview.classList.remove("hidden");
				};
				reader.readAsDataURL(file);
			} else {
				preview.classList.add("hidden");
				previewImg.src = "";
			}
		});
	</script>

</body>

</html>